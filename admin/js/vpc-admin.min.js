(function(b){b(document).ready(function(){function r(){b("#vpc-preview").html("");b(".default-config:checked").each(function(){var a=b(this).closest(".vpc-option-row").find(".vpc-option-img img").attr("data-original");a||(a=b(this).closest(".vpc-option-row").find(".vpc-option-img img").attr("src"));a&&b("#vpc-preview").append("<img src='"+a+"'>")})}function k(a,c){var d="";void 0!=a&&b.each(a,function(a,g){void 0!==g.cname&&void 0!==g.options&&(d+='<optgroup label="'+g.cname+'">',b.each(g.options,
function(a,b){a=" ";var e="";b.hasOwnProperty("option_id")&&""!=b.option_id?e=b.option_id:b.hasOwnProperty("name")&&(e="component_"+f(g.cname.replace(/ /g,""))+"_group_"+f(b.group.replace(/ /g,""))+"_option_"+f(b.name.replace(/ /g,"")));void 0!=c&&c==e&&(a='selected="selected"');d+='<option value="'+e+'"  '+a+">"+g.cname+" > "+b.name+"</option>"}),d+="</optgroup>")});return d}function f(a){for(var b=[{re:/[\xC0-\xC6]/g,ch:"A"},{re:/[\xE0-\xE6]/g,ch:"a"},{re:/[\xC8-\xCB]/g,ch:"E"},{re:/[\xE8-\xEB]/g,
ch:"e"},{re:/[\xCC-\xCF]/g,ch:"I"},{re:/[\xEC-\xEF]/g,ch:"i"},{re:/[\xD2-\xD6]/g,ch:"O"},{re:/[\xF2-\xF6]/g,ch:"o"},{re:/[\xD9-\xDC]/g,ch:"U"},{re:/[\xF9-\xFC]/g,ch:"u"},{re:/[\xC7-\xE7]/g,ch:"c"},{re:/[\xD1]/g,ch:"N"},{re:/[\xF1]/g,ch:"n"}],d=0,e=b.length;d<e;d++)a=a.replace(b[d].re,b[d].ch);return a.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"").replace(/\-{2,}/g,"-").replace(/^\-/g,"").replace(/\-$/,"")}function m(a,c){var d="";void 0!=a&&b.each(a,function(b,a){if(void 0!==a.cname&&
void 0!==a.options){b=" ";var e=a.hasOwnProperty("component_id")&&""!=a.component_id?a.component_id:"component_"+f(a.cname.replace(/ /g,""));void 0!=c&&c==e&&(b='selected="selected"');d+='<option value="'+e+'" '+b+">"+a.cname+"</option>"}});return d}function y(){if(0<b(".wvpc-conditional-rule-wrap").length){var a=wvpc_cond_rules_data.current_configuration.conditional_rules;if(a&&void 0!=a.groups){var c="";b.each(a.groups,function(a,d){var e="";if("undefined"==typeof d.rules)return!0;b.each(d.rules,
function(b,c){wvpc_cond_rules_data.wvpc_conditional_rule_tpl.replace(/{rule-index}/g,b);b=h(b,a,c,d.result);e+=b});var g=wvpc_cond_rules_data.wvpc_cl_group_container_tpl.replace(/{rule-group}/g,e).replace(/{enable-reverse-cb}/g,l(d,a));c+=n(g,a)});a=b(".wvpc-rules-table-container").html();a=a.replace(/{rules-editor}/g,c)}else{var d=h(0,0);d=wvpc_cond_rules_data.wvpc_cl_group_container_tpl.replace(/{rule-group}/g,d).replace(/{enable-reverse-cb}/g,l("",0));a=b(".wvpc-rules-table-container").html();
a=a.replace(/{rules-editor}/g,d)}b(".wvpc-rules-table-container").html(a);p();t()}}function n(a,b,d){a&&(void 0!=b&&(a=a.replace(/{rule-group-index}/g,b)),void 0!=d&&(a=a.replace(/{rule-index}/g,d)));return a}function t(){var a=b(':input[name*="vpc-config["]').serializeJSON();wvpc_cond_rules_data.current_configuration=a["vpc-config"];b(".wvpc-extraction-group-option").each(function(){var a=k(wvpc_cond_rules_data.current_configuration.components,b(this).val());b(this).html(a)});b(".wvpc-extraction-group-apply_on").each(function(){var a=
b(this).parents(".wvpc-rules-table-tr").find(".wvpc-extraction-group-scope").val();"option"==a?(a=k(wvpc_cond_rules_data.current_configuration.components,b(this).val()),b(this).html(a)):"component"==a&&(a=m(wvpc_cond_rules_data.current_configuration.components,b(this).val()),b(this).html(a))});p()}function q(a,c,d,e,g){var f='<select name="'+a+'" id="'+c+'" class="'+d+'">';b.each(e,function(a,b){f=a==g?f+('<option value="'+a+'"  selected="selected" >'+b+"</option>"):f+('<option value="'+a+'">'+b+
"</option>")});return f+="</select>"}function p(){b.each(b(".wvpc-shared-td"),function(a,c){a=b(c).parents("table.wvpc-rules-table").find("tr").length;b(c).attr("rowspan",a)})}function h(a,b,d,e){var c=0==a?wvpc_cond_rules_data.wvpc_conditional_rule_tpl_first_row:wvpc_cond_rules_data.wvpc_conditional_rule_tpl;var f=q("vpc-config[conditional_rules][groups][{rule-group-index}][rules][{rule-index}][trigger]","wvpc-group_{rule-group-index}_rule_{rule-index}_trigger","select wvpc-extraction-group-trigger",
wvpc_cond_rules_data.wvpc_cl_trigger,d?d.trigger:""),h=k(wvpc_cond_rules_data.current_configuration.components,d?d.option:""),l=q("vpc-config[conditional_rules][groups][{rule-group-index}][result][scope]","wvpc-group_{rule-group-index}_rule_{rule-index}_scope","select wvpc-extraction-group-scope",wvpc_cond_rules_data.wvpc_cl_scope,e?e.scope:"");d=d&&e.scope&&"component"==e.scope?m(wvpc_cond_rules_data.current_configuration.components,e?e.apply_on:""):k(wvpc_cond_rules_data.current_configuration.components,
e?e.apply_on:"");e=q("vpc-config[conditional_rules][groups][{rule-group-index}][result][action]","wvpc-group_{rule-group-index}_rule_{rule-index}_action","select wvpc-extraction-group-action",wvpc_cond_rules_data.wvpc_cl_action,e?e.action:"");c=c.replace(/{wvpc-extraction-group-trigger}/g,f);c=c.replace(/{wvpc-extraction-group-option}/g,h);c=c.replace(/{wvpc-extraction-group-scope}/g,l);c=c.replace(/{wvpc-extraction-group-action}/g,e);c=c.replace(/{wvpc-extraction-group-apply_on}/g,d);return c=n(c,
b,a)}function l(a,b){var c="",e="",f="";if("on"==a.apply_reverse||""==a)c='checked="checked"';"or"==a.conditions_relationship?e="selected":f="selected";return n('<div class="enable-reverse"><label for=""><input type="checkbox" name="vpc-config[conditional_rules][groups][{rule-group-index}][apply_reverse]" '+c+" />"+string_translations.reverse_cb_label+"</label> </div>"+('<div class="vpc-conditions-relationship"><label for="">'+string_translations.group_conditions_relation+'<select name="vpc-config[conditional_rules][groups][{rule-group-index}][conditions_relationship]"><option value="and" '+
f+'>AND</option><option value="or" '+e+">OR</option></select></label> </div>"),b)}function u(){b("#vpc-config-components-table > tbody > tr").each(function(a,c){var d="vpc-config[components]["+a+"]";b(this).find(":input[name^='vpc-config[components]']").each(function(a,c){a=this.name.replace(/vpc-config\[components\]\[\d+\]/,d);b(this).attr("name",a)})})}function z(){b(".o-modal .omodal-body>.table-fixed-layout> tbody > tr:visible").each(function(a,c){var d="[options]["+a+"]";b(this).find(":input[name*='[options]']").each(function(a,
c){a=this.name.replace(/\[options\]\[\d+\]/,d);b(this).attr("name",a)})})}function v(){b(".o-modal .table-fixed-layout>tbody").sortable({update:function(a,b){z()}})}function A(){if(b("#vpc-config-settings-box").length){var a=b("#vpc-config-settings-box").offset().left,c=b("#vpc-config-settings-box").outerWidth();b("body").append("<style>.o-modal .omodal-dialog{width: "+c+"px;margin-left: "+a+"px;}</style")}}function w(){b('.vpc-component-id[value=""]').each(function(a,c){a=o_uniqid("component-");
b(c).val(a);c="component_"+f(b(c).parent().parent().find(".vpc-cname").val().replace(/ /g,""));b('option[value="'+c+'"]').attr("value",a)})}function x(){b('.vpc-option-id[value=""]').each(function(a,c){a="component_"+f(b(c).parents(".omodal").parents().parents().find(".vpc-cname").val().replace(/ /g,""))+"_group_"+f(b(c).parents().parent().find(".vpc-option-group").val().replace(/ /g,""))+"_option_"+f(b(c).parent().parent().find(".vpc-option-name").val().replace(/ /g,""));var d=o_uniqid("option-");
b('option[value="'+a+'"]').attr("value",d);b(c).val(d)})}b("[data-tooltip-title]").tooltip();setTimeout(function(){0<b("body.post-type-vpc-config").length&&u();r();y();b("#vpc-config-components-table > tbody").sortable({update:function(a,b){u()}});b(".wvpc-rules-table td.value select[data-selected]").each(function(){var a=b(this).data("selected");b(this).val(a)});v();A();w();x()},3E3);b(document).on("change",".default-config",function(a){b(this).parents(".omodal-body").find("input[type=radio]").not(b(this)).attr("checked",
!1);r()});b(document).on("change",".wvpc_enable_conditional_logic",function(){b(this).is(":checked")?b(this).parents(".wvpc-conditional-logic-main-container").find(".wvpc-wvpc-conditional-logic-tr").show():b(this).parents(".wvpc-conditional-logic-main-container").find(".wvpc-wvpc-conditional-logic-tr").hide()});b(document).on("change",".wvpc-extraction-group-scope",function(a){var c=b(this).val();a=b(this).parent().parent().find(".wvpc-extraction-group-apply_on");"option"==c?(c=k(wvpc_cond_rules_data.current_configuration.components,
a.data("selected_option")),a.html(c)):"component"==c&&(c=m(wvpc_cond_rules_data.current_configuration.components,a.data("selected_option")),a.html(c))});b(document).on("click",".wvpc-add-rule",function(a){setTimeout(check_the_max_input_vars,200);a=b(".wvpc-rules-table tr").length;var c=b(this).data("group");a=h(a,c);b(this).parents(".wvpc-rules-table").find("tbody").append(a);p()});b(document).on("click",".wvpc-add-group",function(a){setTimeout(check_the_max_input_vars,200);a=b(".wvpc-rules-table-container .wvpc-rules-group-container").last().find(".wvpc-rules-table-tr").attr("data-id");
a=parseInt(a.replace("rule_",""))+1;var c=h(0,a),d=l("",a);c=wvpc_cond_rules_data.wvpc_cl_group_container_tpl.replace(/{rule-group}/g,c);c=c.replace(/{enable-reverse-cb}/g,d);c=c.replace(/{rule-group-index}/g,a);c=c.replace(/{rule-index}/g,0);b(".wvpc-rules-table-container").append(c)});b(document).on("click",".wvpc-remove-rule",function(a){a.preventDefault();setTimeout(check_the_max_input_vars,200);b(this).parent().parent().remove()});b(".vpc-config-skin").change(function(){var a=b(this).val();a=
vpc_components_skins[a];b(".vpc-behaviour").html(a)});b("#vpc-config-container>div>table>tbody>tr>td>.add-rf-row").click(function(){setTimeout(v,1E3)});b(document).on("change",".vpc-cname, .vpc-option-group, .vpc-option-name",function(){t()});b(document).on("click",".add-rf-row",function(a){setTimeout(function(){w();x()},200)})})})(jQuery);